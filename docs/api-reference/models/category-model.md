# CategoryModel

Represents a spending category in Centabit (e.g., Groceries, Dining, Transport).

## Overview

`CategoryModel` is an immutable domain model representing a transaction category. Categories help organize spending and enable budget allocations. Each category has an associated icon for visual identification.

**Location:** `lib/data/models/category_model.dart`

## Properties

### Core Fields

#### `id` (String, required)
Unique identifier (UUID v4).

Auto-generated by `.create()` factory. Used in transaction and allocation links.

```dart
final id = category.id; // "c1a2b3c4-d5e6-f7g8-h9i0-j1k2l3m4n5o6"
```

#### `name` (String, required)
Category display name.

**Common examples:**
- `"Groceries"`
- `"Dining & Restaurants"`
- `"Transportation"`
- `"Entertainment"`
- `"Healthcare"`
- `"Utilities"`

```dart
final name = category.name; // "Groceries"
```

**Best practices:**
- Use clear, descriptive names
- Capitalize for consistency
- Keep names concise (1-3 words)

#### `iconName` (String, required)
Icon identifier for visual representation.

References Flutter icon names or custom asset identifiers used in the app's icon system.

```dart
final iconName = category.iconName; // "shopping_cart"
```

**Usage:**
```dart
// In UI widgets
Icon(
  _getIconData(category.iconName),
  color: theme.colorScheme.primary,
)
```

**Common icon names:**
- `"shopping_cart"` - Groceries
- `"restaurant"` - Dining
- `"directions_car"` - Transportation
- `"movie"` - Entertainment
- `"local_hospital"` - Healthcare
- `"lightbulb"` - Utilities

### Timestamp Fields

#### `createdAt` (DateTime, required)
Timestamp when category was created.

Auto-generated by `.create()` factory. Immutable after creation.

#### `updatedAt` (DateTime, required)
Timestamp when category was last modified.

Auto-generated by `.create()`. Updated automatically on `.copyWith()` in repository layer.

## Factory Constructors

### `CategoryModel.create()`

Creates a new category with auto-generated ID and timestamps.

**Signature:**
```dart
factory CategoryModel.create({
  required String name,
  required String iconName,
})
```

**Parameters:**
- `name` - Category display name (required)
- `iconName` - Icon identifier (required)

**Auto-generated:**
- `id` - New UUID v4
- `createdAt` - Current timestamp
- `updatedAt` - Current timestamp

**Example:**
```dart
// Create basic categories
final groceries = CategoryModel.create(
  name: 'Groceries',
  iconName: 'shopping_cart',
);

final dining = CategoryModel.create(
  name: 'Dining & Restaurants',
  iconName: 'restaurant',
);

final transport = CategoryModel.create(
  name: 'Transportation',
  iconName: 'directions_car',
);

final entertainment = CategoryModel.create(
  name: 'Entertainment',
  iconName: 'movie',
);
```

### `CategoryModel.fromJson()`

Deserializes category from JSON map.

**Signature:**
```dart
factory CategoryModel.fromJson(Map<String, dynamic> json)
```

**Example:**
```dart
final json = {
  'id': 'c1a2b3c4-d5e6-f7g8-h9i0-j1k2l3m4n5o6',
  'name': 'Groceries',
  'iconName': 'shopping_cart',
  'createdAt': '2024-11-20T10:00:00.000Z',
  'updatedAt': '2024-11-20T10:00:00.000Z',
};

final category = CategoryModel.fromJson(json);
```

## Methods

### `toJson()`

Serializes category to JSON map.

**Signature:**
```dart
Map<String, dynamic> toJson()
```

**Example:**
```dart
final json = category.toJson();
// {
//   'id': '...',
//   'name': 'Groceries',
//   'iconName': 'shopping_cart',
//   ...
// }
```

### `copyWith()`

Creates a copy with modified fields (Freezed-generated).

**Signature:**
```dart
CategoryModel copyWith({
  String? id,
  String? name,
  String? iconName,
  DateTime? createdAt,
  DateTime? updatedAt,
})
```

**Example:**
```dart
// Rename category
final renamed = category.copyWith(name: 'Grocery Shopping');

// Change icon
final newIcon = category.copyWith(iconName: 'shopping_basket');

// Update both
final updated = category.copyWith(
  name: 'Food & Groceries',
  iconName: 'food_bank',
);
```

## Usage Examples

### Create and Save Category

```dart
import 'package:centabit/data/models/category_model.dart';
import 'package:centabit/data/repositories/category_repository.dart';

// Create category
final category = CategoryModel.create(
  name: 'Groceries',
  iconName: 'shopping_cart',
);

// Save via repository
final repository = getIt<CategoryRepository>();
await repository.createCategory(category);
```

### Create Default Categories

```dart
// Set up common categories for new users
final defaultCategories = [
  CategoryModel.create(
    name: 'Groceries',
    iconName: 'shopping_cart',
  ),
  CategoryModel.create(
    name: 'Dining & Restaurants',
    iconName: 'restaurant',
  ),
  CategoryModel.create(
    name: 'Transportation',
    iconName: 'directions_car',
  ),
  CategoryModel.create(
    name: 'Entertainment',
    iconName: 'movie',
  ),
  CategoryModel.create(
    name: 'Healthcare',
    iconName: 'local_hospital',
  ),
  CategoryModel.create(
    name: 'Utilities',
    iconName: 'lightbulb',
  ),
  CategoryModel.create(
    name: 'Shopping',
    iconName: 'shopping_bag',
  ),
];

// Save all
for (final category in defaultCategories) {
  await categoryRepository.createCategory(category);
}
```

### Update Category

```dart
// Fetch existing
final existing = await repository.getCategoryById(categoryId);

// Update name
final updated = existing!.copyWith(
  name: 'Food & Groceries',
  updatedAt: DateTime.now(),
);

// Save changes
await repository.updateCategory(updated);
```

### Category Dropdown/Picker

```dart
// Get all categories for picker
final categories = categoryRepository.categories;

// Build dropdown
DropdownButton<String>(
  value: selectedCategoryId,
  items: categories.map((category) {
    return DropdownMenuItem(
      value: category.id,
      child: Row(
        children: [
          Icon(_getIconData(category.iconName)),
          SizedBox(width: 8),
          Text(category.name),
        ],
      ),
    );
  }).toList(),
  onChanged: (categoryId) {
    setState(() => selectedCategoryId = categoryId);
  },
)
```

### Calculate Category Spending

```dart
// Get all transactions for a category
final categoryTransactions = transactionRepository.transactions
  .where((tx) => tx.categoryId == categoryId)
  .where((tx) => tx.type == TransactionType.debit)
  .toList();

// Calculate total spent
final totalSpent = categoryTransactions.fold<double>(
  0,
  (sum, tx) => sum + tx.amount,
);

print('${category.name}: \$${totalSpent.toStringAsFixed(2)}');
```

### Display Category with Icon

```dart
// In a widget
class CategoryChip extends StatelessWidget {
  final CategoryModel category;

  const CategoryChip({required this.category});

  @override
  Widget build(BuildContext context) {
    return Chip(
      avatar: CircleAvatar(
        child: Icon(_getIconData(category.iconName), size: 16),
      ),
      label: Text(category.name),
    );
  }

  IconData _getIconData(String iconName) {
    // Map icon names to IconData
    switch (iconName) {
      case 'shopping_cart':
        return Icons.shopping_cart;
      case 'restaurant':
        return Icons.restaurant;
      case 'directions_car':
        return Icons.directions_car;
      // ... more mappings
      default:
        return Icons.category;
    }
  }
}
```

## Relationships

### One-to-Many with Transactions

```
Category (1) ──< (N) Transactions
```

A category has many transactions. Transactions reference categories via `categoryId`.

**Access:**
```dart
// Get transactions for category
final categoryTransactions = transactionRepository.transactions
  .where((tx) => tx.categoryId == category.id)
  .toList();

// Denormalization in cubit
final transactionVModels = transactions.map((tx) {
  final category = tx.categoryId != null
    ? categoryRepository.getCategoryByIdSync(tx.categoryId!)
    : null;

  return TransactionVModel(
    id: tx.id,
    name: tx.name,
    amount: tx.amount,
    categoryName: category?.name,
    categoryIconName: category?.iconName,
  );
}).toList();
```

### One-to-Many with Allocations

```
Category (1) ──< (N) Allocations
```

A category has many allocations (one per budget). Allocations reference categories via `categoryId`.

**Access:**
```dart
// Get allocations for category
final categoryAllocations = allocationRepository
  .getAllocationsForCategory(category.id);

// Calculate total allocated to this category across all budgets
final totalAllocated = categoryAllocations.fold<double>(
  0,
  (sum, alloc) => sum + alloc.amount,
);

print('${category.name} total allocated: \$${totalAllocated}');
```

## View Model Pattern

Categories are often denormalized into view models for UI display:

### TransactionVModel Example

```dart
// TransactionVModel includes denormalized category data
class TransactionVModel {
  final String id;
  final String name;
  final double amount;
  final String? categoryId;
  final String? categoryName;      // Denormalized
  final String? categoryIconName;  // Denormalized
  // ...
}

// Built in TransactionListCubit
final viewModel = TransactionVModel(
  id: transaction.id,
  name: transaction.name,
  amount: transaction.amount,
  categoryId: transaction.categoryId,
  categoryName: category?.name,         // Joined from CategoryRepository
  categoryIconName: category?.iconName, // Joined from CategoryRepository
);
```

This avoids repeated repository lookups in UI widgets.

## Best Practices

### Use `.create()` for New Categories
Always use the factory constructor:

```dart
// ✅ Good - auto-generates ID and timestamps
final category = CategoryModel.create(
  name: 'Groceries',
  iconName: 'shopping_cart',
);

// ❌ Bad - requires manual management
final category = CategoryModel(
  id: Uuid().v4(),
  name: 'Groceries',
  iconName: 'shopping_cart',
  createdAt: DateTime.now(),
  updatedAt: DateTime.now(),
);
```

### Choose Descriptive Names
Make category names clear and specific:

```dart
// ✅ Good - clear and specific
CategoryModel.create(name: 'Dining & Restaurants', ...)
CategoryModel.create(name: 'Public Transportation', ...)
CategoryModel.create(name: 'Home Utilities', ...)

// ❌ Bad - vague or unclear
CategoryModel.create(name: 'Food', ...) // Too broad
CategoryModel.create(name: 'Stuff', ...) // Not descriptive
CategoryModel.create(name: 'Cat 1', ...) // No context
```

### Use Consistent Icon Names
Establish a standard icon naming convention:

```dart
// ✅ Good - consistent Material Icons naming
CategoryModel.create(name: 'Groceries', iconName: 'shopping_cart')
CategoryModel.create(name: 'Dining', iconName: 'restaurant')
CategoryModel.create(name: 'Transport', iconName: 'directions_car')

// ❌ Bad - inconsistent naming
CategoryModel.create(name: 'Groceries', iconName: 'cart') // Short name
CategoryModel.create(name: 'Dining', iconName: 'restaurantIcon') // Camel case
CategoryModel.create(name: 'Transport', iconName: 'CAR') // All caps
```

### Pre-populate Default Categories
Provide default categories for better user experience:

```dart
// On first app launch or user creation
Future<void> seedDefaultCategories() async {
  final existingCategories = categoryRepository.categories;
  if (existingCategories.isNotEmpty) return; // Already seeded

  final defaults = [
    CategoryModel.create(name: 'Groceries', iconName: 'shopping_cart'),
    CategoryModel.create(name: 'Dining', iconName: 'restaurant'),
    CategoryModel.create(name: 'Transportation', iconName: 'directions_car'),
    CategoryModel.create(name: 'Entertainment', iconName: 'movie'),
    CategoryModel.create(name: 'Healthcare', iconName: 'local_hospital'),
    CategoryModel.create(name: 'Utilities', iconName: 'lightbulb'),
    CategoryModel.create(name: 'Shopping', iconName: 'shopping_bag'),
    CategoryModel.create(name: 'Other', iconName: 'category'),
  ];

  for (final category in defaults) {
    await categoryRepository.createCategory(category);
  }
}
```

### Allow Uncategorized Transactions
Transactions can have `categoryId == null`:

```dart
// Handle null category in UI
final categoryName = transaction.categoryId != null
  ? categoryRepository.getCategoryByIdSync(transaction.categoryId!)?.name
  : 'Uncategorized';

// Or provide a default "Other" category
final defaultCategory = CategoryModel.create(
  name: 'Other',
  iconName: 'category',
);
```

## Common Queries

### Get All Categories Sorted by Name

```dart
final categories = categoryRepository.categories
  ..sort((a, b) => a.name.compareTo(b.name));
```

### Get Categories with Spending

```dart
// Categories that have at least one transaction
final usedCategories = categoryRepository.categories.where((category) {
  return transactionRepository.transactions.any(
    (tx) => tx.categoryId == category.id,
  );
}).toList();
```

### Find Category by Name

```dart
CategoryModel? findCategoryByName(String name) {
  try {
    return categoryRepository.categories.firstWhere(
      (cat) => cat.name.toLowerCase() == name.toLowerCase(),
    );
  } catch (e) {
    return null;
  }
}
```

## See Also

- [TransactionModel](./transaction-model.md) - Transaction entity
- [AllocationModel](./allocation-model.md) - Budget allocation entity
- [CategoryRepository](../repositories/category-repository.md) - Data access
- [TransactionListCubit](../cubits/transaction-list-cubit.md) - Denormalization example
