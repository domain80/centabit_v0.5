import{_ as a,c as n,o as i,a2 as e}from"./chunks/framework.Bj-1CPTZ.js";const k=JSON.parse('{"title":"Architecture Overview","description":"","frontmatter":{},"headers":[],"relativePath":"architecture/index.md","filePath":"architecture/index.md","lastUpdated":1767998922000}'),l={name:"architecture/index.md"};function t(p,s,r,c,o,h){return i(),n("div",null,[...s[0]||(s[0]=[e(`<h1 id="architecture-overview" tabindex="-1">Architecture Overview <a class="header-anchor" href="#architecture-overview" aria-label="Permalink to &quot;Architecture Overview&quot;">​</a></h1><h2 id="system-architecture-diagram" tabindex="-1">System Architecture Diagram <a class="header-anchor" href="#system-architecture-diagram" aria-label="Permalink to &quot;System Architecture Diagram&quot;">​</a></h2><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│                       Presentation Layer                        │</span></span>
<span class="line"><span>│  ┌────────────┐  ┌────────────┐  ┌────────────┐                │</span></span>
<span class="line"><span>│  │   Pages    │  │  Widgets   │  │   Cubits   │                │</span></span>
<span class="line"><span>│  │  (UI)      │  │  (UI)      │  │ (BLoC)     │                │</span></span>
<span class="line"><span>│  └────────────┘  └────────────┘  └─────┬──────┘                │</span></span>
<span class="line"><span>│                                         │                        │</span></span>
<span class="line"><span>│                              Stream subscriptions               │</span></span>
<span class="line"><span>└─────────────────────────────────────────┼─────────────────────┘</span></span>
<span class="line"><span>                                          │</span></span>
<span class="line"><span>                                          ↓</span></span>
<span class="line"><span>┌─────────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│                       Repository Layer                          │</span></span>
<span class="line"><span>│  ┌──────────────────────────────────────────────────────────┐  │</span></span>
<span class="line"><span>│  │ TransactionRepository │ CategoryRepository │ etc...      │  │</span></span>
<span class="line"><span>│  │  - Broadcast streams                                     │  │</span></span>
<span class="line"><span>│  │  - Transform Drift ↔ Domain models                      │  │</span></span>
<span class="line"><span>│  │  - Sync stubs (ready for API)                           │  │</span></span>
<span class="line"><span>│  └──────────────────┬───────────────────┬───────────────────┘  │</span></span>
<span class="line"><span>└─────────────────────┼───────────────────┼──────────────────────┘</span></span>
<span class="line"><span>                      │                   │</span></span>
<span class="line"><span>                      ↓                   ↓</span></span>
<span class="line"><span>         ┌────────────────────┐  ┌─────────────────┐</span></span>
<span class="line"><span>         │   LocalSources     │  │  RemoteSources  │</span></span>
<span class="line"><span>         │   (Drift/SQLite)   │  │   (Future API)  │</span></span>
<span class="line"><span>         ├────────────────────┤  ├─────────────────┤</span></span>
<span class="line"><span>         │ • userId filtering │  │ • HTTP client   │</span></span>
<span class="line"><span>         │ • Reactive watch() │  │ • Auth headers  │</span></span>
<span class="line"><span>         │ • CRUD operations  │  │ • Error handling│</span></span>
<span class="line"><span>         └─────────┬──────────┘  └─────────────────┘</span></span>
<span class="line"><span>                   │</span></span>
<span class="line"><span>                   ↓</span></span>
<span class="line"><span>         ┌────────────────────┐</span></span>
<span class="line"><span>         │  Drift Database    │</span></span>
<span class="line"><span>         │  (centabit.sqlite) │</span></span>
<span class="line"><span>         ├────────────────────┤</span></span>
<span class="line"><span>         │ Tables:            │</span></span>
<span class="line"><span>         │ • transactions     │</span></span>
<span class="line"><span>         │ • categories       │</span></span>
<span class="line"><span>         │ • budgets          │</span></span>
<span class="line"><span>         │ • allocations      │</span></span>
<span class="line"><span>         │ • sync_queue       │</span></span>
<span class="line"><span>         │                    │</span></span>
<span class="line"><span>         │ All with userId    │</span></span>
<span class="line"><span>         │ + sync metadata    │</span></span>
<span class="line"><span>         └────────────────────┘</span></span>
<span class="line"><span>                   ║</span></span>
<span class="line"><span>                   ║ (Sync in isolate)</span></span>
<span class="line"><span>                   ↓</span></span>
<span class="line"><span>         ┌────────────────────┐</span></span>
<span class="line"><span>         │   SyncManager      │</span></span>
<span class="line"><span>         │   (Background)     │</span></span>
<span class="line"><span>         ├────────────────────┤</span></span>
<span class="line"><span>         │ • Isolate-based    │</span></span>
<span class="line"><span>         │ • Periodic timer   │</span></span>
<span class="line"><span>         │ • Status streaming │</span></span>
<span class="line"><span>         └────────────────────┘</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><h2 id="layer-responsibilities" tabindex="-1">Layer Responsibilities <a class="header-anchor" href="#layer-responsibilities" aria-label="Permalink to &quot;Layer Responsibilities&quot;">​</a></h2><h3 id="_1-presentation-layer" tabindex="-1">1. Presentation Layer <a class="header-anchor" href="#_1-presentation-layer" aria-label="Permalink to &quot;1. Presentation Layer&quot;">​</a></h3><p><strong>Location</strong>: <code>lib/features/[feature]/presentation/</code></p><p><strong>Components</strong>:</p><ul><li><strong>Pages</strong>: Full-screen UI components that represent app routes</li><li><strong>Widgets</strong>: Reusable UI components specific to a feature</li><li><strong>Cubits</strong>: State management using BLoC pattern</li></ul><p><strong>Responsibilities</strong>:</p><ul><li>Display data to users</li><li>Capture user input</li><li>Subscribe to state changes from Cubits</li><li>Trigger actions via Cubit methods</li><li>NO business logic (kept in Cubits)</li><li>NO direct data access (goes through Cubits → Repositories)</li></ul><p><strong>Example</strong>:</p><div class="language-dart vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// TransactionsPage subscribes to TransactionListCubit</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">BlocBuilder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TransactionListCubit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TransactionListState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  builder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (context, state) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> state.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">when</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    success</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (transactions) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ListView</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/* display */</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    loading</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> CircularProgressIndicator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    error</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (msg) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ErrorWidget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(msg),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_2-repository-layer" tabindex="-1">2. Repository Layer <a class="header-anchor" href="#_2-repository-layer" aria-label="Permalink to &quot;2. Repository Layer&quot;">​</a></h3><p><strong>Location</strong>: <code>lib/data/repositories/</code></p><p><strong>Components</strong>:</p><ul><li><code>TransactionRepository</code></li><li><code>CategoryRepository</code></li><li><code>BudgetRepository</code></li><li><code>AllocationRepository</code></li></ul><p><strong>Responsibilities</strong>:</p><ul><li>Coordinate LocalSources (and future RemoteSources)</li><li>Transform Drift entities ↔ Domain models</li><li>Emit broadcast streams for reactive updates</li><li>Cache latest data for synchronous access</li><li>Manage sync operations (stubs for now)</li><li>Provide clean API to Cubits</li></ul><p><strong>Key Pattern</strong>:</p><div class="language-dart vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> TransactionRepository</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  final</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> TransactionLocalSource</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _localSource;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _controller </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> StreamController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TransactionModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&gt;.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">broadcast</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Subscribe to Drift&#39;s reactive queries</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  TransactionRepository</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._localSource) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    _localSource.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">watchAllTransactions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((driftData) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> models </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> driftData.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(_mapToModel).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toList</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      _latestTransactions </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> models;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Cache</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      _controller.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(models);        </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Emit</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Public API for Cubits</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  Stream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TransactionModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&gt; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> transactionsStream </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _controller.stream;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  List</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">TransactionModel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> transactions </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _latestTransactions;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_3-localsource-layer" tabindex="-1">3. LocalSource Layer <a class="header-anchor" href="#_3-localsource-layer" aria-label="Permalink to &quot;3. LocalSource Layer&quot;">​</a></h3><p><strong>Location</strong>: <code>lib/data/local/</code></p><p><strong>Components</strong>:</p><ul><li><code>database.dart</code> - Drift schema definition</li><li><code>*_local_source.dart</code> - Data access objects (DAOs)</li></ul><p><strong>Responsibilities</strong>:</p><ul><li>Execute type-safe SQL queries via Drift</li><li>Filter ALL queries by userId (security + multi-user)</li><li>Provide reactive streams via Drift&#39;s <code>watch()</code> API</li><li>Handle CRUD operations</li><li>Inject userId automatically on create</li><li>Validate userId on update/delete</li></ul><p><strong>Key Pattern</strong> (userId filtering):</p><div class="language-dart vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">dart</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> TransactionLocalSource</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  final</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AppDatabase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _db;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  final</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> userId;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Injected at construction</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  Stream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">List</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Transaction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&gt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">watchAllTransactions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (_db.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">select</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(_db.transactions)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          ..</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((t) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">              t.userId.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">equals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(userId) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // ALWAYS filter by userId</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">              t.isDeleted.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">equals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">watch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_4-drift-database" tabindex="-1">4. Drift Database <a class="header-anchor" href="#_4-drift-database" aria-label="Permalink to &quot;4. Drift Database&quot;">​</a></h3><p><strong>Location</strong>: <code>lib/data/local/database.dart</code></p><p><strong>Tables</strong>:</p><ul><li><code>Transactions</code> - Financial transactions</li><li><code>Categories</code> - Spending categories</li><li><code>Budgets</code> - Budget periods</li><li><code>Allocations</code> - Budget-to-category allocations</li><li><code>SyncQueue</code> - Offline changes pending sync</li></ul><p><strong>Common Columns</strong> (all tables):</p><ul><li><code>id</code> - Primary key (UUID)</li><li><code>userId</code> - Owner identifier (for filtering)</li><li><code>createdAt</code> - Creation timestamp</li><li><code>updatedAt</code> - Last modification timestamp</li><li><code>isSynced</code> - Sync status flag</li><li><code>isDeleted</code> - Soft delete flag</li><li><code>lastSyncedAt</code> - Last sync timestamp</li></ul><p><strong>Key Features</strong>:</p><ul><li>Type-safe queries (compile-time validation)</li><li>Reactive streams via <code>watch()</code></li><li>Automatic code generation</li><li>Foreign key support</li><li>Composite unique constraints</li></ul><h3 id="_5-syncmanager-background" tabindex="-1">5. SyncManager (Background) <a class="header-anchor" href="#_5-syncmanager-background" aria-label="Permalink to &quot;5. SyncManager (Background)&quot;">​</a></h3><p><strong>Location</strong>: <code>lib/data/sync/</code></p><p><strong>Components</strong>:</p><ul><li><code>SyncManager</code> - Orchestrates background sync</li><li><code>SyncStatus</code> - Sync state (Freezed union type)</li></ul><p><strong>Responsibilities</strong>:</p><ul><li>Run periodic sync in background isolate</li><li>Communicate sync status to UI</li><li>Trigger manual sync on demand</li><li>Handle sync failures with retry logic</li><li>Keep UI thread responsive (non-blocking)</li></ul><p><strong>States</strong>:</p><ul><li><code>idle</code> - No sync in progress</li><li><code>syncing</code> - Currently syncing</li><li><code>synced(DateTime)</code> - Last successful sync</li><li><code>failed(String)</code> - Sync error with message</li><li><code>offline</code> - No network connection</li></ul><h2 id="component-interaction-flow" tabindex="-1">Component Interaction Flow <a class="header-anchor" href="#component-interaction-flow" aria-label="Permalink to &quot;Component Interaction Flow&quot;">​</a></h2><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>User Action (tap button)</span></span>
<span class="line"><span>        ↓</span></span>
<span class="line"><span>Page calls cubit.method()</span></span>
<span class="line"><span>        ↓</span></span>
<span class="line"><span>Cubit calls repository.method()</span></span>
<span class="line"><span>        ↓</span></span>
<span class="line"><span>Repository calls localSource.method()</span></span>
<span class="line"><span>        ↓</span></span>
<span class="line"><span>LocalSource executes Drift query (with userId filter)</span></span>
<span class="line"><span>        ↓</span></span>
<span class="line"><span>Drift emits change via watch() stream</span></span>
<span class="line"><span>        ↓</span></span>
<span class="line"><span>LocalSource forwards stream update</span></span>
<span class="line"><span>        ↓</span></span>
<span class="line"><span>Repository transforms Drift → Domain model</span></span>
<span class="line"><span>        ↓</span></span>
<span class="line"><span>Repository emits to broadcast stream</span></span>
<span class="line"><span>        ↓</span></span>
<span class="line"><span>Cubit&#39;s subscription receives update</span></span>
<span class="line"><span>        ↓</span></span>
<span class="line"><span>Cubit reloads data and emits new state</span></span>
<span class="line"><span>        ↓</span></span>
<span class="line"><span>Page rebuilds with new state</span></span>
<span class="line"><span>        ↓</span></span>
<span class="line"><span>User sees updated UI</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h2 id="key-architectural-principles" tabindex="-1">Key Architectural Principles <a class="header-anchor" href="#key-architectural-principles" aria-label="Permalink to &quot;Key Architectural Principles&quot;">​</a></h2><h3 id="_1-offline-first" tabindex="-1">1. Offline-First <a class="header-anchor" href="#_1-offline-first" aria-label="Permalink to &quot;1. Offline-First&quot;">​</a></h3><ul><li>Local database is the <strong>single source of truth</strong></li><li>All writes go to local DB first (optimistic updates)</li><li>Background sync happens asynchronously</li><li>App works fully offline</li></ul><h3 id="_2-reactive-streams" tabindex="-1">2. Reactive Streams <a class="header-anchor" href="#_2-reactive-streams" aria-label="Permalink to &quot;2. Reactive Streams&quot;">​</a></h3><ul><li>Data changes automatically propagate through layers</li><li>Drift&#39;s <code>watch()</code> emits when database changes</li><li>Repositories forward as broadcast streams</li><li>Cubits subscribe and reload automatically</li><li>UI rebuilds via BLoC pattern</li></ul><h3 id="_3-type-safety" tabindex="-1">3. Type Safety <a class="header-anchor" href="#_3-type-safety" aria-label="Permalink to &quot;3. Type Safety&quot;">​</a></h3><ul><li>Drift provides compile-time query validation</li><li>Freezed ensures immutable models</li><li>Strong typing throughout the stack</li></ul><h3 id="_4-separation-of-concerns" tabindex="-1">4. Separation of Concerns <a class="header-anchor" href="#_4-separation-of-concerns" aria-label="Permalink to &quot;4. Separation of Concerns&quot;">​</a></h3><ul><li>Each layer has a single responsibility</li><li>Clear boundaries between layers</li><li>Dependencies flow inward (Presentation → Data → Database)</li></ul><h3 id="_5-multi-user-ready" tabindex="-1">5. Multi-User Ready <a class="header-anchor" href="#_5-multi-user-ready" aria-label="Permalink to &quot;5. Multi-User Ready&quot;">​</a></h3><ul><li>All queries filter by userId</li><li>Prepared for OAuth integration</li><li>Anonymous users get unique UUID tokens</li><li>Data isolation between users</li></ul><h2 id="technology-stack" tabindex="-1">Technology Stack <a class="header-anchor" href="#technology-stack" aria-label="Permalink to &quot;Technology Stack&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Layer</th><th>Technology</th><th>Purpose</th></tr></thead><tbody><tr><td>UI</td><td>Flutter + Material 3</td><td>Cross-platform UI framework</td></tr><tr><td>State Management</td><td>flutter_bloc (Cubit)</td><td>Reactive state management</td></tr><tr><td>Routing</td><td>go_router</td><td>Declarative navigation</td></tr><tr><td>Dependency Injection</td><td>get_it</td><td>Service locator pattern</td></tr><tr><td>Local Database</td><td>Drift</td><td>Type-safe SQLite ORM</td></tr><tr><td>Models</td><td>Freezed</td><td>Immutable data classes</td></tr><tr><td>Serialization</td><td>json_serializable</td><td>JSON ↔ Dart conversion</td></tr><tr><td>Background Sync</td><td>Dart Isolates</td><td>Non-blocking operations</td></tr><tr><td>Future API</td><td>Dio</td><td>HTTP client (not yet used)</td></tr></tbody></table><h2 id="next-steps-for-api-integration" tabindex="-1">Next Steps for API Integration <a class="header-anchor" href="#next-steps-for-api-integration" aria-label="Permalink to &quot;Next Steps for API Integration&quot;">​</a></h2><p>When the backend API is ready:</p><ol><li><p><strong>Create RemoteSource classes</strong> (<code>lib/data/remote/</code>)</p><ul><li>API client with Dio</li><li>DTOs for API responses</li><li>Auth token interceptors</li></ul></li><li><p><strong>Update Repositories</strong></p><ul><li>Implement sync logic in isolates</li><li>Handle conflict resolution</li><li>Merge local + remote data</li></ul></li><li><p><strong>Activate SyncManager</strong></p><ul><li>Remove stub implementations</li><li>Implement actual API calls</li><li>Handle network errors</li></ul></li><li><p><strong>Add OAuth</strong></p><ul><li>Implement <code>AuthManager.signInWithGoogle()</code></li><li>Migrate anonymous data to authenticated user</li><li>Update userId filtering</li></ul></li></ol><p>See <a href="./sync-strategy">sync-strategy.md</a> for detailed sync implementation plans.</p>`,63)])])}const u=a(l,[["render",t]]);export{k as __pageData,u as default};
